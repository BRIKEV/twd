let a=[];const i=(s,l)=>a.find(e=>e.method===s&&(typeof e.url=="string"?e.url===l:new RegExp(e.url).test(l)));self.addEventListener("fetch",s=>{const{method:l}=s.request,e=s.request.url,t=i(l,e);t&&(console.log("Mock hit:",t.alias,l,e),s.respondWith((async()=>{let n=null;try{n=await s.request.clone().text()}catch{}return self.clients.matchAll().then(o=>{o.forEach(r=>r.postMessage({type:"EXECUTED",alias:t.alias,request:n}))}),new Response(JSON.stringify(t.response),{status:t.status||200,headers:t.headers||{"Content-Type":"application/json"}})})()))});self.addEventListener("message",s=>{const{type:l,rule:e}=s.data||{};l==="ADD_RULE"&&(a=a.filter(t=>t.alias!==e.alias),a.push(e),console.log("Rule added:",e))});
