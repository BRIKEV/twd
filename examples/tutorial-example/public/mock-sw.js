(function(){"use strict";const d=e=>{try{return new RegExp(e),!0}catch{return!1}},f=new Set(["js","mjs","cjs","ts","tsx","jsx","mts","cts","css","scss","sass","less","styl","html","htm","xml","xhtml","vue","svelte","json","yaml","yml","toml","csv","txt","md","mdx","pdf","doc","docx","png","jpg","jpeg","gif","svg","webp","ico","bmp","avif","woff","woff2","ttf","eot","otf","mp3","mp4","webm","ogg","wav","zip","tar","gz","rar","map"]),u=e=>{const n=e.split("?")[0].match(/\.([a-zA-Z0-9]+)$/);return n?f.has(n[1].toLowerCase()):!1};function h(e,s,n){return n.find(t=>{const o=t.method.toLowerCase()===e.toLowerCase();if(t.urlRegex&&d(t.url)){const r=new RegExp(t.url);return o&&r.test(s)}if(u(t.url))return o&&s.includes(t.url);const c=t.url===s||s.includes(t.url);return o&&c&&!u(s)})}function p(e,s,n){e.forEach(t=>t.postMessage({type:"EXECUTED",alias:s.alias,request:n}))}const m=(e,s,n)=>{const o=![204,205,304].includes(s),l=o?JSON.stringify(e):null;return new Response(l,{status:s,headers:o?n||{"Content-Type":"application/json"}:n||{}})},a="1.4.2";let i=[];const y=async e=>{const{method:s}=e.request,n=e.request.url,t=h(s,n,i);t&&(console.log("[TWD] Mock hit:",t.alias,s,n),e.respondWith((async()=>{let o=null;const l=e.request.headers.get("content-type")||"application/json";if(l.includes("application/json"))try{o=await e.request.clone().json()}catch{}else if(l.includes("form"))try{const r=await e.request.clone().formData();o={},r.forEach((E,x)=>{o[x]=E})}catch{}else if(l.includes("text"))try{o=await e.request.clone().text()}catch{}else if(l.includes("octet-stream"))try{o=await e.request.clone().arrayBuffer()}catch{}else if(l.includes("image"))try{o=await e.request.clone().blob()}catch{}else try{o=await e.request.clone().text()}catch{}const c=await self.clients.matchAll();return p(c,t,o),m(t.response,t.status??200,t.responseHeaders)})()))},g=e=>{e!==a&&console.warn(`[TWD] ⚠️ Version mismatch detected:
Client version: ${e}
Service Worker version: ${a}

This may lead to unexpected behavior.
Please unregister the Service Worker and reload the page to ensure compatibility.

To reinstall:
  npx twd-js init public --save

Docs: https://brikev.github.io/twd/api-mocking.html#_1-install-mock-service-worker`)},w=e=>{const{type:s,rule:n,version:t}=e.data||{};g(t),s==="ADD_RULE"&&(i=i.filter(o=>o.alias!==n.alias),i.push(n),console.log("[TWD] Rule added:",n)),s==="CLEAR_RULES"&&(i=[],console.log("[TWD] All rules cleared"))};self.addEventListener("install",()=>{self.skipWaiting()}),self.addEventListener("activate",e=>{e.waitUntil(self.clients.claim())}),console.log(`[TWD] Mock Service Worker loaded - version ${a}`),self.addEventListener("fetch",y),self.addEventListener("message",w)})();
